<!DOCTYPE HTML>
<html>
<!--
<?php
	session_start();
	if ($_SESSION["username"] == "" && $_SESSION["username"]== null) {
		echo "<META HTTP-EQUIV='REFRESH' CONTENT='1; URL=../registro.html'>";
    session_destroy();
}?> -->

<head>
    <title>Petición Vacaciones</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/css/main.css"/>
    <link rel="shortcut icon" href="lib/assets/img/iconoarriba.png"/>

    <!-- CSS -->
    <link rel="stylesheet" href="lib/sweetalert2.css">

    <!-- JavaScript -->
    <script src="lib/sweetalert2.all.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="lib/jquery-ui.min.css">

    <!-- JavaScript (requiere jQuery) -->
    <script src="lib/jquery-3.6.0.min.js"></script>
    <script src="lib/jquery-ui.min.js"></script>

    <noscript>
        <link rel="stylesheet" href="assets/css/noscript.css"/>
    </noscript>

</head>

<body class="is-preload">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<!-- Wrapper -->
<script>
    $(document).ready(function () {
        $('.zoom').hover(function () {
            $(this).addClass('transition');
        }, function () {
            $(this).removeClass('transition');
        });
    });
</script>
<div id="wrapper">

    <!-- Header -->
    <header id="header" class="alt">
        <span class="logo"><img height="100px" src="images/Recurso 6 (2).png" alt=""/></span>
        <h1>¡Petición de vacaciones!</h1>
        <p>Bienvenido a tu portal de consulta.</p>
    </header>
    <!-- Main -->
    <div id="main">
        <!-- Second Section -->
        <section id="second" class="main special">
            <header class="major">
                <h1 id="contador">05:00</h1>
                <h2>Petición de vacaciones</h2>
                <div class="col-6 col-12-xsmall">
                    <label class="etiqueta">Seleccione supervisor :</label>
                    <select name="" id="sltSupervisor">
                        <option value=""></option>
                        <option value="Uziel Landa">Uziel Landa</option>
                        <option value="Monica Aguilar">Monica Aguilar</option>
                        <option value="Alberto Ordonez">Alberto Ordoñez</option>
                    </select>
                </div>

                <div id="ShiftLeader" style="display: none">
                    <div class="col-6 col-12-xsmall">
                        <label class="etiqueta">Seleccione su Shift Leader : </label>
                        <select name="demo-name" id="sltShiftleader">
                            <option value=""></option>
                            <option value="Uziel">Uziel Landa</option>
                            <option value="Julia Jasson">Julia Jasso</option>
                            <option value="Erick Zamarron">Erick Zamarron</option>
                        </select>
                    </div>
                </div>

                <div id="Turno" style="display: none">
                    <div class="col-6 col-12-xsmall">
                        <label class="etiqueta">Seleccione su turno : </label>
                        <select name="demo-name" id="sltTurno">
                            <option value=""></option>
                            <option value="PrimerTurno">Primer Turno</option>
                            <option value="SegundoTurno">Segundo Turno</option>
                            <option value="TercerTurno">Tercer Turno</option>
                        </select>
                    </div>
                </div>

                <div id="OperacionSeccion" style="display: none">

                    <div class="col-6 col-12-xsmall">
                        <label class="etiqueta">Ingresa su operación : </label>
                        <input type="text" name="" placeholder="Ingresa tu operacion" id="txtOperacion">
                    </div>
                </div>

                <div id="FechasSeccion" style="display: none">
                    <div class="col-6 col-12-xsmall">
                        <label class="etiqueta">Seleccione fecha de peticion : </label>
                        <input type="date" name="" id="fechaPeticion" onchange="verificar()" min="2023-06-01"
                               max="2023-06-30">
                        <div id="peticiones">
                            <div id="lista" class="table-wrapper">
                                <br>
                                <table id="tablaDatos">
                                    <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Descripcion</th>
                                    </tr>
                                    </thead>
                                    <tbody id="contenido tabla">
                                    </tbody>
                                    <tfoot>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>

                    <br>
                    <button id="btnSecond" style='margin-top:15px;' class="primary"
                            onclick="compilacionDatos();">Enviar
                    </button>
                    <button id="open" style='margin-top:15px; background-color: lightcoral;'
                            class="primary">Cancelar
                    </button>
                </div>
            </header>
        </section>
    </div>

    <!-- Footer -->
    <footer id="footer">
        <section>
            <h2>Información</h2>
            <dl class="alt">
                <dt>Dirección</dt>
                <dd>Av. de la luz #24 int.&bull; 3 y 4 &bull; Acceso III</dd>
                <dd>Parque Ind. Benito Juárez &bull;76120 &bull;
                <dd>Querétaro, Qro. México</dd>
                <dt>RH</dt>
                <dd> +52 (42) 36 44 60</dd>
                <dt>Vigilancia</dt>
                <dd> +52 (42) 38 44 00</dd>
                <dt>Servicio Medico</dt>
                <dd> +52 (42) 38 44 64</dd>
            </dl>
            <ul class="icons">
                <li><a href="https://es-la.facebook.com/grammerqueretaro/"
                       class="icon brands fa-facebook-f alt"><span class="label">Facebook</span></a></li>
                <li><a href="https://www.instagram.com/grammerqro/" class="icon brands fa-instagram alt"><span
                        class="label">Instagram</span></a></li>
                <li><a href="https://mx.linkedin.com/in/grammer-quer%C3%A9taro-b04b6611b"
                       class="icon brands fa-linkedin alt"><span class="label">LinkeIn</span></a></li>
            </ul>
        </section>
        <p class="copyright">&copy; Grammer Automotive Puebla S.A de C.V.: <a href="#">Grammer Queretaro</a>.</p>
    </footer>

</div>

<!-- Scripts -->
<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/jquery.scrollex.min.js"></script>
<script src="assets/js/jquery.scrolly.min.js"></script>
<script src="assets/js/browser.min.js"></script>
<script src="assets/js/breakpoints.min.js"></script>
<script src="assets/js/util.js"></script>
<script src="assets/js/main.js"></script>
<script src="script.js"></script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/v52afc6f149f6479b8c77fa569edb01181681764108816"
        integrity="sha512-jGCTpDpBAYDGNYR5ztKt4BQPGef1P0giN6ZGVUi835kFF88FOmmn8jBQWNgrNd8g/Yu421NdgWhwQoaOPFflDw=="
        data-cf-beacon='{"rayId":"7cd6c8fc89644871","token":"cd0b4b3a733644fc843ef0b185f98241","version":"2023.4.0","si":100}'
        crossorigin="anonymous"></script>

<script>

    var fechaActual = new Date();

    fechaActual.setMinutes(fechaActual.getMinutes() + 5);

    console.log(fechaActual);

    var token = getParameterByName("token");

    function getParameterByName(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
            results = regex.exec(location.search);
        var cadena = results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
        var arrTerminos = cadena.split(',');
        return arrTerminos[0];
    }

    var selectSupervisor = document.getElementById("sltSupervisor");
    var selectShiftleader = document.getElementById("sltShiftleader");
    var selectTurno = document.getElementById("sltTurno");
    var txtOperacion = document.getElementById("txtOperacion");

    var shiftleaderSeccion = document.getElementById("ShiftLeader");
    var turnoSeccion = document.getElementById("Turno");
    var operacionSeccion = document.getElementById("OperacionSeccion");
    var fechaSeccion = document.getElementById("FechasSeccion");

    selectSupervisor.addEventListener("change", function () {
        if (selectSupervisor.value !== "") {
            shiftleaderSeccion.style.display = "block";
            shiftleaderSeccion.style.animation = "fade-in 0.9s";
        } else {
            shiftleaderSeccion.style.display = "none";
        }
    });

    selectShiftleader.addEventListener("change", function () {
        if (selectShiftleader.value !== "") {
            turnoSeccion.style.display = "block";
            turnoSeccion.style.animation = "fade-in 0.9s";
        } else {
            turnoSeccion.style.display = "none";
        }
    });

    selectTurno.addEventListener("change", function () {
        if (selectTurno.value !== "") {
            operacionSeccion.style.display = "block";
            operacionSeccion.style.animation = "fade-in 0.9s";
        } else {
            operacionSeccion.style.display = "none";
        }
    });

    txtOperacion.addEventListener("input", function () {
        if (txtOperacion.value !== "") {
            fechaSeccion.style.display = "block";
            fechaSeccion.style.animation = "fade-in 0.9s";
        } else {
            fechaSeccion.style.display = "none";
        }
    });

    var myInput = document.getElementById("fechaPeticion");
    var today = new Date(); // Obtener la fecha actual
    var minDate = today.toISOString().split("T")[0]; // Convertir la fecha actual a formato ISO (AAAA-MM-DD)
    var maxDate = new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000).toISOString().split("T")[0]; // Calcular la fecha máxima sumando 30 días a la fecha actual

    myInput.min = minDate;
    myInput.max = maxDate;


    var contador = 0;

    function verificar() {
        var inputFecha = document.getElementById("fechaPeticion");
        var fechaSeleccionada = new Date(inputFecha.value);
        var diasBloqueados = [10, 20, 21]; // Días bloqueados (por ejemplo)

        var diaSeleccionado = fechaSeleccionada.getDate() + 1;
        var mesSeleccionado = today.getMonth() + 1;
        if (diasBloqueados.includes(diaSeleccionado)) {
            inputFecha.value = "";
            alert("El día " + diaSeleccionado + " está bloqueado. Por favor, selecciona otra fecha.");
        } else {
            var tabla = document.getElementById("tablaDatos");

            var fila = document.createElement("tr");
            var celdaFecha = document.createElement("td");
            var parrafoFecha = document.createElement("div");

            var dia = (fechaSeleccionada.getDate() + 1).toString().padStart(2, "0");
            var mes = (fechaSeleccionada.getMonth() + 1).toString().padStart(2, "0");
            var anio = fechaSeleccionada.getFullYear().toString();

            parrafoFecha.textContent = dia + "/" + mes + "/" + anio;

            celdaFecha.appendChild(parrafoFecha);

            var celdaEliminar = document.createElement("td");
            var botonEliminar = document.createElement("button");
            botonEliminar.textContent = "Eliminar";
            botonEliminar.onclick = function () {
                tabla.removeChild(fila);
            };

            celdaEliminar.appendChild(botonEliminar);
            fila.appendChild(celdaFecha);
            fila.appendChild(celdaEliminar);
            tabla.appendChild(fila);
        }
    }

    function eliminarElemento(elemento) {
        elemento.remove();
    }

    function compilacionDatos() {
        var tabla = document.getElementById("tablaDatos");
        var elementosP = tabla.querySelectorAll("td div");
        var valores = [];

        for (var i = 0; i < elementosP.length; i++) {
            var elementoP = elementosP[i];
            var valor = elementoP.textContent.trim().replaceAll("Eliminar", "");
            valores.push(valor);

        }
        //insertarDatos(valores);
        alert(valores);
    }

    function insertarDatos(datos) {

        var supervisor = document.getElementById("sltSupervisor");
        var shiftLeader = document.getElementById("sltShiftleader");
        var Turno = document.getElementById("sltTurno");
        var operacion = document.getElementById("txtOperacion");

        var otrosDatos = {
            SupervisorAux: supervisor,
            ShiftLeaderAux: shiftLeader,
            TurnoAux: Turno,
            OperacionAux: operacion
        };

        var requestData = {
            arrayDatos: datos,
            otrosDatos: otrosDatos
        };

        fetch("insertar.php", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(requestData)
        })
            .then(response => response.text())
            .then(data => {
                console.log(data); // Mostrar la respuesta del servidor
            })
            .catch(error => {
                console.error("Error:", error);
            });
    }

    var contadorElemento = document.getElementById("contador");
    var fechaActual = new Date().getTime();
    var fechaFinal = new Date(fechaActual + (5 * 60 * 1000));

    var intervalo = setInterval(function () {
        var ahora = new Date().getTime();
        var diferencia = fechaFinal - ahora;

        var minutos = Math.floor((diferencia % (1000 * 60 * 60)) / (1000 * 60));
        var segundos = Math.floor((diferencia % (1000 * 60)) / 1000);

        minutos = minutos < 10 ? "0" + minutos : minutos;
        segundos = segundos < 10 ? "0" + segundos : segundos;
        contadorElemento.innerHTML = minutos + ":" + segundos;

        if (diferencia < 0) {
            clearInterval(intervalo);
            contadorElemento.innerHTML = "00:00";
            actualizarEstatus();
        }
    }, 1000)

    function actualizarEstatus() {
        $.getJSON('https://arketipo.mx/public_html/RH/Vacaciones/dao/DaoActualizarEstatus.php?6486f0e4=' + token, function (data) {
            if (data.data[0].Estatus != "0") {
                let timerInterval
                Swal.fire({
                    title: 'Se acabo su tiempo!',
                    html: 'Sera expulsado de la fila en <b></b> milliseconds.',
                    timer: 2000,
                    timerProgressBar: true,
                    didOpen: () => {
                        Swal.showLoading()
                        const b = Swal.getHtmlContainer().querySelector('b')
                        timerInterval = setInterval(() => {
                            b.textContent = Swal.getTimerLeft()
                        }, 50)
                    },
                    willClose: () => {
                        clearInterval(timerInterval)
                    }
                }).then((result) => {
                    /* Read more about handling dismissals below */
                    if (result.dismiss === Swal.DismissReason.timer) {
                        window.location.href = 'https://arketipo.mx/public_html/RH/Vacaciones/login.html';
                    }
                })
            } else {
                alert("Correcto");
            }
        });
    }

</script>

<script>
    /*var id = "<?php echo $_SESSION["username"] ?>";
    var tag;
    var text;


    if(id=='00016069'){
        document.getElementById('avisoG').style.display = 'block';
    }



    function getParameterByName(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
            results = regex.exec(location.search);


        var cadena = results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));

        var arrTerminos = cadena.split(',');


        return arrTerminos[0];
    }

    $.getJSON('https://arketipo.mx/GrammerApp/inicio/DaoUsuario.php?usuario=' + id, function (data) {
        text = data.data[0].NomUser;
        const myArray = text.split(" ");
        let word = myArray[0] + ' ' + myArray[1];

        document.getElementById('nombre').innerHTML = word;
        document.getElementById('nombre2').value = word;
        document.getElementById('linea').innerHTML = data.data[0].NombreCC;
        document.getElementById('area').value = data.data[0].NombreCC;
        tag = data.data[0].IdTag;
        orden(data.data[0].IdTag);
    });

    $.getJSON('https://arketipo.mx/GrammerApp/inicio/kaizen.php?usuario=' + id, function (data) {

        document.getElementById('puntosKaizen').innerHTML = data.data[0].Puntos;
    });

    $.getJSON('https://arketipo.mx/Test/GrammerApp/inicio/DaoPrenomina.php', function (data) {
        for (var i = 0; i < data.data.length; i++) {
            if (data.data[i].Tipo == 'pdf') {
                if (data.data[i].Nombre == 'bonoAsistencia'){
                    document.getElementById('fechaMensajeBono').innerHTML = "Ultima fecha de actualizacion es " + data.data[i].Fecha;
                    document.getElementById("mensajeVista").innerHTML=data.data[i].Mensaje;
                }
                if (data.data[i].Nombre == 'prenomina'){
                    document.getElementById('fechaMensaje').innerHTML = "Ultima fecha de actualizacion es " + data.data[i].Fecha;
                }}

            if (data.data[i].Tipo == 'video') {
                document.getElementById('video').src = data.data[i].Mensaje;
            }

            if (data.data[i].IdArchivo == '17') {
                document.getElementById('1').src = "images/" + data.data[i].Nombre + ".jpg";
                document.getElementById('nombreOrg').innerHTML = data.data[i].Mensaje;
            }

            if (data.data[i].IdArchivo == '18') {
                document.getElementById('2').src = "images/" + data.data[i].Nombre + ".png";
            }

            if (data.data[i].IdArchivo == '19') {
                document.getElementById('3').src = "images/" + data.data[i].Nombre + ".png";
            }

            if (data.data[i].IdArchivo == '20') {
                document.getElementById('4').src = "images/" + data.data[i].Nombre + ".png";
            }

            if (data.data[i].IdArchivo == '21') {
                document.getElementById('5').src = "images/" + data.data[i].Nombre + ".png";
            }



            if (data.data[i].IdArchivo == '5') {
                document.getElementById('6').src = "images/" + data.data[i].Nombre + ".png";
            }

            if (data.data[i].IdArchivo == '6') {
                document.getElementById('7').src = "images/" + data.data[i].Nombre + ".png";
            }

            if (data.data[i].IdArchivo == '7') {
                document.getElementById('8').src = "images/" + data.data[i].Nombre + ".png";
            }

            if (data.data[i].IdArchivo == '8') {
                document.getElementById('9').src = "images/" + data.data[i].Nombre + ".png";
                document.getElementById('10').src = "images/" + data.data[i].Nombre + ".png";
            }
        }
    });

    function orden(tag) {
        $.getJSON('https://arketipo.mx/GrammerApp/inicio/DaoVacaciones.php?usuario=' + id, function (data) {
            document.getElementById('vacaciones').innerHTML = data.data[0].DiasVacaciones;

            var fechaAux = data.data[0].FechaIngreso;
            let divicionFecha = fechaAux.split('-');
            ano = divicionFecha[0];
            mes = divicionFecha[1];
            dia = divicionFecha[2];

            if (mes == '01') {
                mes = 'enero';
            }
            if (mes == '02') {
                mes = 'febrero';
            }
            if (mes == '03') {
                mes = 'marzo';
            }
            if (mes == '04') {
                mes = 'abril';
            }
            if (mes == '05') {
                mes = 'mayo';
            }
            if (mes == '06') {
                mes = 'junio';
            }
            if (mes == '07') {
                mes = 'julio';
            }
            if (mes == '08') {
                mes = 'agosto';
            }
            if (mes == '09') {
                mes = 'septiembre';
            }
            if (mes == '10') {
                mes = 'octubre';
            }
            if (mes == '11') {
                mes = 'noviembre';
            }
            if (mes == '12') {
                mes = 'diciembre';
            }

            document.getElementById('antiguedad').innerHTML = dia + " de " + mes + " del " + ano;
        });
    }

    function ordenTag() {

        var tagIngreso = document.getElementById('numerotag').value;

        if (tagIngreso == tag) {
            $.getJSON('https://arketipo.mx/GrammerApp/inicio/DaoCajaAhorro.php?usuario=' + tag, function (data) {

                document.getElementById('nombre').innerHTML = text;
                document.getElementById('nombre2').value = text;
                document.getElementById('caja').innerHTML = '0';
                document.getElementById('prestamos').innerHTML = '0';

                document.getElementById('caja').innerHTML = data.data[0].AhorroTotal;
                document.getElementById('prestamos').innerHTML = data.data[0].PendientePrestamo;
                document.getElementById('fondoAhorro').innerHTML = data.data[0].FondoAhorro;
            });
        } else {
            alert('Este numero de tag no pertenece a tu cuenta');
        }


    }

    function carta(tipo) {

        document.getElementById('cargaRegistro').innerHTML = '<div class="loading"><center><img src="images/cargando.gif" height="150px"><br/>Un momento, por favor...</center></div>';

        const data = new FormData();

        data.append('nomina', id);

        fetch('DaoEstatus.php', {
            method: 'POST',
            body: data
        })
            .then(function (response) {
                if (response.ok) {
                    correo(id, tipo);
                } else {
                    throw "Error en la llamada Ajax";
                }

            })
            .then(function (texto) {
                console.log(texto);
            })
            .catch(function (err) {
                console.log(err);
            });

    }

    function correo(nomina, tipo) {

        var link = "https://arketipo.mx/GrammerApp/inicio/pdf.php?usuario=" + id + "&tipo=" + tipo;

        const data = new FormData();

        data.append('NominaUsuario', nomina);
        data.append('Tipo', tipo);
        data.append('Link', link);

        fetch('https://arketipo.mx/testphpmailGrammer.php', {
            method: 'POST',
            body: data
        })
            .then(function (response) {
                if (response.ok) {
                    document.getElementById('cargaRegistro').style.display = 'none';
                    document.getElementById('registrado').style.display = 'block';
                } else {
                    throw "Error en la llamada Ajax";
                }

            })
            .then(function (texto) {
                console.log(texto);
            })
            .catch(function (err) {
                console.log(err);
            });


    }

    function anonima() {
        document.getElementById('nombre2').value = 'Anonima';
        document.getElementById('area').value = 'Anonima';
    }

*/
</script>

</body>

</html>